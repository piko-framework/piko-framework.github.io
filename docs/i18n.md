---
layout: default
title: i18n
nav_order: 6
---

# Internationalization (i18n)

Internationalization can be integrated in a Piko Framework project by using a separate package:

```bash
composer require piko/i18n
```

This package will install the [I18n](../api/I18n.md) [component](concepts.md#component).

In order to use the [I18n](../api/I18n.md) [component](concepts.md#component), translations have to be stored in PHP 
files that return a key-value pair array of translations. Keys are strings to translate 
and values are corresponding translated strings.

Example of translation file:

```php
// fr.php
return [
    'Translation test' => 'Test de traduction',
    'Hello {name}' => 'Bonjour {name}',
];
```

Then the i18n component has to be declared in the application [configuration](application.md#configuration):

```php
return [
    //...
    'components' => [
        'i18n' => [
            'class' => 'piko\I18n',
            'translations' => [
                'app' => '@app/messages'
            ]
        ],
    ],
];

```

Finally, the component needs the LANG environment variable to include the appropriate translation file.

This can be done in the [entry script](application.md#entry-script) or in any part of the application before invoking the i18n component.

```php
$_ENV['LANG'] = 'fr';
```

Once the i18n component correctly configured, it can be invoked in two ways:

```php
use piko\Piko;

$i18n = Piko::get('i18n');

echo $i18n->translate('app', 'Translation test') . '<br>'; // Test de traduction
echo $i18n->translate('app', 'Hello {name}', ['name' => 'John']) . '<br>' ; // Bonjour John

// Using the proxy function __() :
echo __('app', 'Translation test') . '<br>'; // Test de traduction
echo __('app', 'Hello {name}', ['name' => 'John']) . '<br>' ;  // Bonjour John

```

## Dynamic language loading

A multi language application needs to switch languages dynamically.

The component doesn't offers a ready to use solution but this can be implemented without big effort.

A commonly used solution is to extract the first element of an URI to set the language. 

in a Piko application, we can extract the language from the URI by listening the `beforeRoute` event.
We can also prepend the language to each generated URL using the [Router::getUrl](../api/router.md#method_getUrl) method. 
For that, we have to listen to the `afterBuildUri` event of the router.

Bellow, an implementation example in the [entry script](application.md#entry-script):

```php
<?php
use piko\Application;
require '../vendor/autoload.php';

$config = require '../config.php';
$app = new Application($config);

$app->on('beforeRoute', function()
{
    /* 
     * Extract the language from the uri 
     * ex: with /fr/blog uri, it will extract 'fr' and set the LANG env variable with 'fr'
     */
    if (preg_match('/^\/([a-z]{2})\//', $_SERVER['REQUEST_URI'], $match)) {
        $lang = $match[1];
        $_SERVER['REQUEST_URI'] = preg_replace('/^\/' . $lang . '\//', '/', $_SERVER['REQUEST_URI']);
        $_ENV['LANG'] = $lang;
    }
});

$router = $app->getRouter();

$router->on('afterBuildUri', function(&$uri) {
    /* 
     * Prepend the language to the uri when using Router::getUrl() 
     * ex: with /blog uri, it will be /fr/blog
     */
    $uri = '/' . $_ENV['LANG']. $uri;
});

$app->run();
```
    

